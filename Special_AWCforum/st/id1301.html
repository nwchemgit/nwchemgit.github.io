<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
	
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta name="generator" content="MediaWiki 1.16.4" />
<meta name="keywords" content="Compiling nwchem-6.3 in a contemporary HPC with Xeon PHI Viewed 3603 times, With a total of 14 Posts" />
<!--[if lt IE 5.5000]><link rel="stylesheet" href="/skins/gumax/IE50Fixes.css?270" media="screen" /><![endif]-->
<!--[if IE 5.5000]><link rel="stylesheet" href="/skins/gumax/IE55Fixes.css?270" media="screen" /><![endif]-->
<!--[if IE 6]><link rel="stylesheet" href="/skins/gumax/IE60Fixes.css?270" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/skins/gumax/IE70Fixes.css?270" media="screen" /><![endif]-->
		<!--[if lt IE 7]><script type="text/javascript" src="/skins/common/IEFixes.js?270"></script>
		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->

		<script>
var skin="gumax",
stylepath="/skins",
wgUrlProtocols="http.html\\:\\/\\/|https\\:\\/\\/|ftp\\:\\/\\/|irc\\:\\/\\/|gopher\\:\\/\\/|telnet\\:\\/\\/|nntp\\:\\/\\/|worldwind\\:\\/\\/|mailto\\:|news\\:|svn\\:\\/\\/",
wgArticlePath="/index.php/$1",
wgScriptPath="",
wgScriptExtension=".php",
wgVariantArticlePath=false,
wgActionPaths={},
wgCanonicalNamespace="Special",
wgCanonicalSpecialPageName="AWCforum",
wgNamespaceNumber=-1,
wgPageName="Special_AWCforum",
wgTitle="AWCforum",
wgAction="view",
wgArticleId=0,
wgIsArticle=true,
wgUserName=null,
wgUserGroups=null,
wgUserLanguage="en",
wgContentLanguage="en",
wgBreakFrames=true,
wgCurRevisionId=0,
wgVersion="1.16.4",
wgEnableAPI=true,
wgEnableWriteAPI=true,
wgSeparatorTransformTable=["", ""],
wgDigitTransformTable=["", ""],
wgMainPageTitle="Main Page",
wgFormattedNamespaces={"-2": "Media", "-1": "Special", "0": "", "1": "Talk", "2": "User", "3": "User talk", "4": "NWChem", "5": "NWChem talk", "6": "File", "7": "File talk", "8": "MediaWiki", "9": "MediaWiki talk", "10": "Template", "11": "Template talk", "12": "Help", "13": "Help talk", "14": "Category", "15": "Category talk", "500": "Release-60", "501": "Release-60 talk", "502": "Release61", "503": "Release61 talk", "504": "Release62", "505": "Release62 talk", "506": "Release64", "507": "Release64 talk", "508": "Release65", "509": "Release65 talk", "510": "Development", "511": "Development talk", "512": "Release66", "513": "Release66 talk", "121707": "Forum"},
wgNamespaceIds={"media": -2, "special": -1, "": 0, "talk": 1, "user": 2, "user_talk": 3, "nwchem": 4, "nwchem_talk": 5, "file": 6, "file_talk": 7, "mediawiki": 8, "mediawiki_talk": 9, "template": 10, "template_talk": 11, "help": 12, "help_talk": 13, "category": 14, "category_talk": 15, "release-60": 500, "release-60_talk": 501, "release61": 502, "release61_talk": 503, "release62": 504, "release62_talk": 505, "release64": 506, "release64_talk": 507, "release65": 508, "release65_talk": 509, "development": 510, "development_talk": 511, "release66": 512, "release66_talk": 513, "forum": 121707, "ns_reldoc64": "NS_RELDOC65", "ns_reldoc64_talk": "NS_RELDOC65_TALK", "image": 6, "image_talk": 7},
wgSiteName="NWChem",
wgCategories=[],
wgRestrictionEdit=[],
wgRestrictionMove=[];
</script>
		<!-- Head Scripts -->
<style type="text/css">
#bodyContent a[href ^="http://"] {
background: none;
    padding-right: 0px;
}

#bodyContent a.external {
background: none;
	padding-right: 0px;
}

#p-cactions li a {
text-transform: capitalize;
}

#contentSub {
margin: 0;
padding: 2px;
padding-bottom: 6px;
}

pre {
margin:0px; 
    padding:5px;
    padding-bottom:20px;  
    
    width: 600px;
    overflow:auto;
    overflow-y: visible;
    line-height: 100%;
}

.top_user_links {
margin: 0;
    padding: 0;
    border-bottom: 1px solid #aaa;
    text-align: right;
}

#TopMenuLinksHolder li a:hover {

}

#TopMenuLinksHolder li a {

}

#TopMenuLinksHolder li {
margin-top: 4px;   
    margin-left: 4px;
    margin-bottom: 0px;
    
    padding: 3px;
    
    list-style: none;
    float: right;
    display: block;
    
    width: auto;
    white-space: nowrap;
    
    border: 1px solid #aaa;
    border-bottom: 0px;
    
    color: #000;
    text-decoration: none;
    font: 11px Verdana;
    text-align: left;
    z-index: 3;
}

#TopMenuLinksHolder a:visited {

}

#TopMenuLinksHolder div a:hover {
background: #FFF;
    color: #000;
}

#TopMenuLinksHolder div a {
position: relative;
        display: block;
        margin: 0;
        padding: 5px;
        width: auto;
        white-space: nowrap;
        text-align: left;
        text-decoration: none;
        font: 11px arial;
}

#TopMenuLinksHolder div {
position: absolute;
    visibility: hidden;
    margin: 0;
    padding: 0;
    background: #DDDDDD;
    border: 1px solid #AAAAAA;
}

#TopMenuLinksHolder {
margin: 0;
    padding: 0;
    z-index: 3;
}

.UserNameOptions {

}

#UserNameOptions a:visited {

}

#UserNameOptions li a:hover {

}

#UserNameOptions li a {
font: 11px Verdana;
}

#UserNameOptions li {
list-style: none;
    display: block;
    white-space: nowrap;
    border: 0px;
    color: #000;
    text-align: left;
    text-decoration: none;
}

#UserNameOptions div a:hover {
color: #FFF;
}

#UserNameOptions div a {
position: relative;
        display: block;
        margin: 0;
        padding: 5px;
        
        width: 500px;
        
        white-space: nowrap; 
        text-align: left;
        text-decoration: none;
        font: 11px arial;
}

#UserNameOptions div {
position: absolute;
    display: block;
    visibility: hidden;
    margin: 0;
    padding: 5px;
    background: #DDDDDD;
    border: 1px solid #AAAAAA;
    white-space: nowrap; 
    font: 12px arial;
    line-height: 100%;
}

#UserNameOptions {
margin: 0;
    padding: 0;
    z-index: 2;
}

.group_text {
font-size: 84%;
    width: auto;
    padding: 0px;
}

.edited_on {
border-top: 1px solid #aaa;
    margin: 0px;
    margin-bottom: 0px;
    padding-left: 5px;
    font-size: 12px;
}

.post_title {

}

.post_date {
border-bottom: 1px solid #aaa;
    font-size: 90%;
    padding-left: 2px;
}

.post_td {
background-color: #f9f9f9;
    border-left: 1px solid #aaa;
    margin: .0em;
    padding: .0em;
}

.post_body {
padding: .5em;
    padding-top: 0px;
}

.post0 {
background-color: #E5E5E5;
    border-left: 1px solid #aaa;
    padding: .0em;
}

.post1 {
background-color: #f9f9f9;
    border-left: 1px solid #aaa;
    padding-bottom: .0em;
}

.post_footer {
/* post, quote, edit buttons */
    margin: 0;
    padding: .7em;
    padding-bottom: 0em;
}

.post_box {
margin-top: 5px;
    margin-left: 5px;
    margin-right: 2px;
    width: auto;
}

.mem_name {
border-bottom: 1px solid #aaa;
    margin: 0;
    padding: .4em;
}

.adv {
border: 0px;
    margin: 0em;
    padding: 0em;
}

.thread_sig {
border-top: 2px solid #aaa;
    margin: 3px;
    padding-left: 5px;
}

#subscribe_menu {
position: absolute;
    background: #ccc ;
    border: 1px solid #aaa;
    border-top: 0px;
    margin: 0em;
    padding: 5px;
    padding-top: 0px;
    top:auto;
    right:65px;
    z-index: 2;
}

.drop_down_buttons:hover {
background: #ccc ;
}

.drop_down_buttons {
margin: 0em;
    white-space: nowrap;
    border-bottom: 1px solid #aaa;
    border-top: 0px;
    padding: 5px;
    color: #000;
    text-align: center;
    background: #fff ;
}

.mod_menu_row {
text-align: left;
}

.post_buttons:hover {
background: #fff ;
}

.post_buttons {
white-space: nowrap;
    float: right;
    margin-top: .5em;
    margin-right: 5px;
    border: 1px solid #aaa;
    border-bottom: 0em;
    padding-left: 5px;
    padding-right: 5px;
    padding-bottom: 0px;
    color: #000;
}

.quote_title {
border: 1px dashed #aaa;
	padding: 5px;
	background-color: #f9f9f9;
	font-family:"Courier New", Courier, mono;
}

.quote {
border-top: 1px solid #000;
	background-color: #fff;
	padding: 10px;
	font-size: 95%;
}

.user_options_row {
border: 1px solid #aaa;
    background: #fff ;
    padding: .3em;
}

.t_userinfo {
white-space:nowrap;
    text-align: left;
    margin: 0;
    padding: .7em;
    padding-bottom: 0em;
}

.ThreadOtions {
margin: 0;
    padding: 0;
    text-align: right;
}

#ThreadOtions a:visited {

}

#ThreadOtions li a:hover {

}

#ThreadOtions li a {
border: 1px solid #aaa;
    border-bottom: 0em;
    padding: 4px;
}

#ThreadOtions li {
list-style: none;
    display: block;
    white-space: nowrap;
    
    border: 0px;
    color: #000;
    
    text-decoration: none;
    z-index: 3;
}

#ThreadOtions div a:hover {
background: #FFF;
    color: #000;
}

#ThreadOtions div a {
position: relative;
        display: block;
        margin: 0;
        padding: 2px;
        border: 0em;
        
        white-space: nowrap; 
        text-align: left;
        text-decoration: none;
        font: 11px arial;
}

#ThreadOtions div {
position: absolute; 
    right: 50px;
    visibility: hidden;
    margin: 0;
    padding: 5px;
    background: #DDDDDD;
    border: 1px solid #AAAAAA;
    white-space: nowrap; 
    text-align: left;
}

#ThreadOtions {
margin-top: 3px;
    padding: 0;
    z-index: 3;
}

.forum_posts {
border: 1px solid #aaa;
    margin: 0em;
    padding: 0em;
    width: 100%;

 width: 100%;
}

.post {
background-color: #f9f9f9;
    border-left: 1px solid #aaa;
    padding: .0em;
}

#search_box {
white-space:nowrap;
    text-align: right; 
    margin: .0em;
    padding: 0px;
}

.search_box {
float: right;
    font-size: 97%;
    margin: .0em;
    color: #000;
    background: #fff;
    border: 1px solid #000;
    margin-left: 5px;
    padding: 0px;
}

.highlightsearchword {
color: #FF0000;
}

.poll_display_table {
border: 1px solid #aaa;
    
    padding: 1px;
}

.poll_displayheader {
border-bottom: 1px dashed #aaa;
    padding: 4px;
    background-color: #DDDDDD;
    font-family:"Courier New", Courier, mono;
}

.poll_display_row {
border-bottom: 1px solid #aaa;
    background-color: #f9f9f9;
    padding: 2px;
}

.poll_display_vote_total {
border-top: 1px solid #aaa;
    padding: 4px;
    background-color: #DDDDDD;
    font-family:"Courier New", Courier, mono;
}

.poll_display_vote_numbers_header {
border: 1px solid #aaa;
border-bottom: 0;
}

.poll_display_vote_percent_header {
border-top: 1px solid #aaa;
    padding: 1px;
}

.poll_display_vote_option_header {
border: 1px solid #aaa;
    border-bottom: 0;
    padding: 1px;
}

.poll_display_vote_numbers {
border: 1px solid #aaa;
    border-bottom: 0;
    padding: 1px;
}

.poll_display_vote_percent {
border-top: 1px solid #aaa;
    padding: 1px;
}

.poll_display_vote_option {
border: 1px solid #aaa;
    border-bottom: 0;
    padding: 1px;
}

.poll_percent_color_op10 {
background-color: #7FFF00;
}

.poll_percent_color_op1 {
background-color: #CD5555;
}

.poll_percent_color_op2 {
background-color: #5CACEE;
}

.poll_percent_color_op3 {
background-color: #FFCC11;
}

.poll_percent_color_op4 {
background-color: #668014;
}

.poll_percent_color_op5 {
background-color: #A0522D;
}

.poll_percent_color_op6 {
background-color: #9F79EE;
}

.poll_percent_color_op7 {
background-color: #EE00EE;
}

.poll_percent_color_op8 {
background-color: #DC143C;
}

.poll_percent_color_op9 {
background-color: #551011;
}

.page_jumps_top:hover {
background: #ccc ;
}

.page_jumps_top {
white-space: nowrap;
    display: inline;
    
    margin: 0px; 
    margin-right: 2px;
    
    border: 1px solid #aaa;
    border-bottom: 0px;
    
    padding-left: 5px;
    padding-right: 5px;
    padding-bottom: 4px;
    
    color: #000;
}

.page_jumps_bot:hover {
background: #ccc ;
}

.page_jumps_bot {
border: 1px solid #aaa;
    border-top: 0px;
    padding-top: 2px;
    margin-left: 2px;
    font-size: 100%;
    padding-left: 5px;
    padding-right: 5px;
    padding-bottom: 2px;
}

.main_memtable {
border: 1px solid #aaa;
}

.main_leftmenu {
border-right: 1px solid #aaa;
     background-color: #f9f9f9;
     width: 175px;
}

.leftmenuheaders {
border: 1px dashed #aaa;
    padding: 2px;
    font-family:"Courier New", Courier, mono;
}

.leftmenu {
background-color: #f9f9f9;
}

.right_body {
padding: 2px;
}

.mem_pm_table {
border: 1px solid #aaa;
    padding: 2px;
    margin: 7px;
}

.pm_header_new {
background-color: #aaa;
    border: 1px solid #000;
    padding: 2px;
    width:5%;
}

.pm_header_title {
background-color: #aaa;
    border: 1px solid #000;
    padding: 2px;
    width:85%;
}

.pm_header_sender {
background-color: #aaa;
    border: 1px solid #000;
    padding: 2px;
    width:5%;
}

.pm_header_date {
background-color: #aaa;
    border: 1px solid #000;
    padding: 2px;
    width:5%;
}

.pm_row {
background-color: #f9f9f9;
    border: 1px solid #000;
    padding: 3px;
}

#cat_list_lastaction_user {
font-size: 90%;
    color: #7d7d7d;
    text-align: right;
    margin-right: 10px;
    line-height: 100%;
}

#cat_list_lastaction_date {
font-size: 90%;
    color: #7d7d7d;
    text-align: right;
    margin-right: 10px;
    line-height: 105%;
}

#cat_list_lastaction_title {
font-size: 90%;
    color: #7d7d7d;
    text-align: right;
    margin-right: 10px;
    line-height: 105%;
}

#small_desc {
font-size: 84%;
    color: #7d7d7d;
	margin-left: 10px;
    width: auto;
}

#cat_forumdisc {
font-size: 84%;
    color: #7d7d7d;
    margin-left: 10px;
    width: auto;
}

.cat_forumrows {
border: 1px solid #aaa;
    background-color: #f9f9f9;
    padding: 5px;
    font-size: 95%;
}

.thread_col_head {
border: 1px solid #aaa;
    margin: 0px;
    padding: 5px;
    white-space: nowrap;
}

.bread_crumbs {
border-bottom: 1px solid #aaa;
    border-top: 0px;
    padding: 2px;
    text-align: left;
}

.dl_maintable_head {
border-right: 1px solid #aaa;
    border-bottom: 1px solid #aaa;
    background-color: #fff;
    padding: 2px;
}

.dl_maintable {
border: 1px solid #aaa;
    margin: 1px;
    padding: 1px;
}

.right_float {
float: right;
	margin-top: 8px;
	padding-left: 5px;
	padding-right: 5px;
	margin-right: 10px;
	margin-left: 10px;
}

.right {
float: right;
	padding-left: 5px;
	padding-right: 5px;
	margin-right: 10px;
	margin-left: 10px;
}

.spacer {
background-color: #aaa;
}

.whos_here_header {
border-bottom: 1px dashed #aaa;
            padding: 4px;
            font-family:"Courier New", Courier, mono;
}

.whos_here_row {
border-bottom: 1px solid #aaa;
            background-color: #f9f9f9;
            padding: 2px;
}

.whos_here {
border: 1px solid #aaa;
            border-bottom: 0;
}

.nothing {
font-size: 0%;
            margin: .0em;
            border: 0;
            margin: 0;
            padding: 0;
            width: 0;
}

.forum_stats {
border: 1px solid #aaa;
            border-bottom: 0;
}

.forum_stats_leftcol {
border-bottom: 1px solid #aaa;
                background-color: #f9f9f9;
                padding: 2px;
}

.forum_stats_rightcol {
background-color: #f9f9f9;
                border-bottom: 1px solid #aaa;
                padding: 2px;
}

.forum_stats_header {
border-bottom: 1px dashed #aaa;
                padding: 4px;
                font-family:"Courier New", Courier, mono;
}

.thread_rows0 {
background-color: #E5E5E5;
    border: 1px solid #aaa;
    border-top: 0px ;
    padding: 2px;
    font-size: 95%;
}

.thread_rows1 {
background-color: #f3f3f3;
    border: 1px solid #aaa;
    border-top: 0px ;
    padding: 2px;
    font-size: 95%;
}

.thread_rows {
background-color: #f9f9f9;
    border: 1px solid #aaa;
    border-top: 0px ;
    padding: 2px;
    font-size: 95%;
}

#annc {
border: 1px solid #000;
	background-color: red;
	padding: 0px;
}

.sticky {
font-style: italic;
    border: 1px solid #aaa;
    border-top: 0px;
    background-color:  #ffa; /* #ffa; e2ffe2 */
    padding: 2px;
    font-size: 95%;
}

.thread_lastaction {
font-size: 84%;
    text-align: right;
    white-space: nowrap;
    display: inline;
}

.pagejumps_PostOnForumPage:hover {
background: #ccc ;
}

.pagejumps_PostOnForumPage {
border: 1px solid #aaa;
    margin-left: 3px;
    font-size: 100%;
    padding-left: 3px;
    padding-right: 3px;
    padding-bottom: 0px;
}

.new_thread_button:hover {
background: #ccc ;
}

.new_thread_button {
white-space: nowrap;
    float: right;
    display: inline; /*fixes IE float bug*/
    margin-top: 0px; 
    margin-bottom: 0px; 
    margin-left: 10px;
   /* margin-left: -4px; */
    border: 1px solid #aaa;
    border-bottom: 0px;
    padding-left: 5px;
    padding-right: 5px;
    padding-bottom: 3px;
    text-align: left; /* 2.4.1 */
    color: #000;
}

#row_info td {
border: 1px solid #aaa;
	border-top: 0px;
	background-color: #f9f9f9;
	padding: 5px;
	font-size: 95%;
}

.page_jumps_holder_thread_bot {
border-bottom: 1px solid #aaa;
}

.page_jumps_holderBot {

}

.poll_thread_listing {
border: 1px solid #aaa;
    border-top: 0px;
    background-color:  #FFCC00;
    padding: 2px;
    font-size: 95%;
}

.locked_thread {
font-style: italic;
    border: 1px solid #aaa;
    border-top: 0px;
    background-color:  #e2ffe2; /* #ffa; e2ffe2 */
    padding: 2px;
    font-size: 95%;
}

#ajax_pmname {
text-align: left;
}

#ajax_pmname ul {
list-style: none;
margin: 0;
}

#ajax_pmname li {
padding: 2px 5px;
	white-space: nowrap;
	text-align: left;
}

#ajax_pmname li:hover {
background: #f9f9f9;
	margin-left: .1em;
	text-decoration: underline;
}

#ajax_pmname li {
padding: 2px 5px;
	white-space: nowrap;
	text-align: left;
}

#ajax_pmname li {
padding: 2px 5px;
	white-space: nowrap;
	text-align: left;
}

#ajax_pmname li {
padding: 2px 5px;
	white-space: nowrap;
	text-align: left;
}

</style>


		<!-- gumax customized style -->

					<style type="text/css">
				#gumax-content-actions li#ca-talk,
				#gumax-content-actions li#ca-history,
				#gumax-content-actions li#ca-edit,
				#gumax-personal-tools
				{ display: none; }
			</style>
		
		<!--[if lt IE 7]>
			<script type="text/javascript" src="/skins/gumax/js/ieunitpngfix-tag.js"></script>
		<![endif]-->

		<!-- end of gumax customized style -->
</head>


<body class="mediawiki ltr ns--1 ns-special page-Special_AWCforum_st_id1301 skin-gumax">

	</div>
	<!-- ///// end of gumax-header ///// -->



		<!-- gumax-content-body -->
		<div id="gumax-column-content">
	<div id="content">
		<a name="top" id="top"></a>
				<h1 id="firstHeading" class="firstHeading gumax-firstHeading" >Compiling nwchem-6.3 in a contemporary HPC with Xeon PHI</h1>
	</tr>
</table>
<br />    <table width="100%" cellpadding="0" cellspacing="0">
        <tr>
            <td width="65%" align="left" nowrap="nowrap"></td>                                         
            <td width="35%" class='ThreadOtions' nowrap></td>    
        </tr>
    </table>       <a name="post_4590"></a>       
        <table class="forum_posts" cellpadding="0" cellspacing="0" id="fullheight">
            <tr>
                <td width="100%" align="left" colspan="2" valign="top" class="mem_name" id="name_4590" nowrap>
                    <table width="100%" cellpadding="0" cellspacing="0">
                        <tr>
                            <td class="UserNameOptions" width="100%">
                                <ul id="UserNameOptions">
                                  <li>
                                    <div id="mem1" onmouseover="mcancelclosetime()" onmouseout="mclosetime()">
                                        
                                    </div>
                                  </li>
                                </ul>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td align="left" nowrap valign="top" width="20">
                    <table cellpadding="0" cellspacing="0" width="20">
                        <tr>
                            <td class="t_userinfo" width="20" nowrap>
                <!-- member_title --><div class="">Clicked A Few Times</div><!-- /member_title -->
                                
                            </td>
                        </tr>
                    </table>
                </td>
                        
            		<td align="left" width="100%" valign="top" id="fullheight">
		                <table width="100%" cellpadding="0" cellspacing="0" class="post0" height="75">
		                    <tr>
		                        <td class="post_date" valign="bottom" height="1px"  width="100%" colspan="2"  nowrap><a target="blank" href="../sp/id4590.html">6:21:51 AM PDT - Mon, Jun 2nd 2014 </a></td>
		                            <td class="post_date" valign="bottom" height="1px" width="100%" nowrap></td>

		                    </tr>
		                                     
		                    <tr>
		                        <td valign="top" class="post_body" height="65" colspan="2">Hello all, <br />
<br />
This is a task in progress, and I would very much appreciate if you have information that can accelerate my task. <br />
<br />
I am trying to compile nwchem, so that it can benefit from various new features of XEONs (i.e. fuse multiply add which can increase the performance ~%40 in some cases), and automatic offloading of intel MKL libraries to phi accelerators. <br />
<br />
Requirements: <br />

<ul><li>A new intel mkl+compiler suite<br />
</li><li>MPI libraries (for scalapack) <br />
</li></ul>
<pre><br />
</pre>
<br />
The things I have done so far: <br />

<ul><li>The environment variables SCALAPACK_LIB; LAPACK_LIB; BLAS_LIB; (but not OPTBLAS);FOPTIONS;FFLAGS;FFLAGS_FORGA;COPTIONS;CXXOPTIONS;CXXFLAGS;CFLAGS;CFLAGS_FORGA;CXXFLAGS_FORGA;FOPTIMIZE;COPTIMIZE used in numerous makefiles has to be set according to intel link line advisor for your setup. <br />
</li><li>Environment variable USE_OPENMP; has to be set, and CC;CXX;FC;F77;MPIF77;MPI_CXX;MPI_CC;MPI_F90 (again various makefiles have different ideas of what is what) has to be set to their corresponding mpi wrappers. <br />
</li><li>environment LINUX64 in src/config/makefile.h has so many workarounds for so many (long depreciated) systems that I ended up adding a new target (INTEL-CLUSTER) with appropriate settings for the system at hand. (Don't forget to edit src/peigs/DEFS so that INTEL-CLUSTER sends the correct flag -DLINUX64)<br />
</li><li>I handle underscore problem by using -assume nounderscore in fortran compilers, and removing the underscores from global arrays macros by hand. I would really appreciate if you have a better solution for this. <br />
</li><li>The rest is handled okay with  contrib/distro-tools/build_nwchem. NWCHEM does not like absolute paths longer than 65 chars. However, it can not be anything less than nwchem-6.3. Since I can not control my home directory as a user I had to make a dirty link trick to get rid of this problem. <br />
</li></ul>
<br />
<br />
Best,<br />
Baris
</td>
		                    </tr>
		                                
		                    
		                    
		                </table>
		            </td>
        </tr> 
           
        <tr><td class="thread_sig" align="left" colspan="2">-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
<br />
Dr. O. Baris Malcioglu,<br />
University of Liege,<br />
Bât. B5 Physique de la matière condensée<br />
allée du 6 Août 17<br />
4000 Liège 1<br />
Belgique<br />
</td></tr>
        	
        </table>
<br />       <a name="post_4601"></a>       
        <table class="forum_posts" cellpadding="0" cellspacing="0" id="fullheight">
            <tr>
                <td width="100%" align="left" colspan="2" valign="top" class="mem_name" id="name_4601" nowrap>
                    <table width="100%" cellpadding="0" cellspacing="0">
                        <tr>
                            <td class="UserNameOptions" width="100%">
                                <ul id="UserNameOptions">
                                  <li>
                                    <div id="mem2" onmouseover="mcancelclosetime()" onmouseout="mclosetime()">
                                        
                                    </div>
                                  </li>
                                </ul>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td align="left" nowrap valign="top" width="20">
                    <table cellpadding="0" cellspacing="0" width="20">
                        <tr>
                            <td class="t_userinfo" width="20" nowrap>
                <!-- member_title --><div class="">Clicked A Few Times</div><!-- /member_title -->
                                
                            </td>
                        </tr>
                    </table>
                </td>
                        
            		<td align="left" width="100%" valign="top" id="fullheight">
		                <table width="100%" cellpadding="0" cellspacing="0" class="post1" height="75">
		                    <tr>
		                        <td class="post_date" valign="bottom" height="1px"  width="100%" colspan="2"  nowrap><a target="blank" href="../sp/id4601.html">3:08:48 AM PDT - Tue, Jun 3rd 2014 </a></td>
		                            <td class="post_date" valign="bottom" height="1px" width="100%" nowrap></td>

		                    </tr>
		                    <tr><td valign="top" height="1px" colspan="2">Update:<hr /></td></tr>                 
		                    <tr>
		                        <td valign="top" class="post_body" height="65" colspan="2">I have learned from the hard way that trying to handle underscore issues in nwchem is a full time job, and better be avoided. At the moment, I have a "compatibility mode" settings which compiles. I am currently doing tests in order to see if it is sensible.<br />
<br />
A very interesting point is that, in my previous settings with mpif90, the fortran wrappers (i.e. those ending with _ using wrapper macro of global arrays) were not created, without a single indication why they are not created. You can only see whether they are created or not by using nm (nm -Ca libga.a)   <br />
<br />
The "compatible" ifort environment settings which ended in a <b>yet untested</b> binary<br />

<pre>
setenv MKLROOT /apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl
setenv NWCHEM_TARGET LINUX64
setenv BLASOPT &quot;-L/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/lib/intel64 -lmkl_intel_ilp64 -lmkl_sequential -lmkl_core -lpthread -lm&quot;
setenv BLAS_LIB &quot;-L/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/lib/intel64 -lmkl_intel_ilp64 -lmkl_sequential -lmkl_core -lpthread -lm&quot;
setenv BLAS_SIZE 8
setenv ARMCI_NETWORK OPENIB
setenv FC ifort
setenv CC icc
setenv CXX icpc
setenv FXX ifort
setenv MPI_CXX icpc
setenv MPI_CC icc
setenv MPI_F90 ifort
setenv FOPTIMIZE &quot;-O3 -xavx -no-prec-div -funroll-loops&quot;
setenv COPTIMIZE &quot;-O3 -xavx -no-prec-div -funroll-loops&quot;
setenv FFLAGS &quot; -i8 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include/intel64/ilp64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include&quot;
setenv FOPTIONS &quot; -i8 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include/intel64/ilp64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include&quot;
setenv CFLAGS &quot; -DMKL_ILP64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include/intel64/ilp64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include&quot;
setenv COPTIONS &quot; -DMKL_ILP64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include/intel64/ilp64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include&quot;
setenv CXXFLAGS &quot; -DMKL_ILP64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include/intel64/ilp64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include&quot;
setenv CXXOPTIONS &quot; -DMKL_ILP64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include/intel64/ilp64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include&quot;
</pre><br />
<br />
The remaining variables necessary for compilation are successfully detected by build_nwchem script<br />

<pre>contrib/distro-tools/build_nwchem &gt;&amp; build.log</pre>
</td>
		                    </tr>
		                                
		                    
		                    
		                </table>
		            </td>
        </tr> 
           
        <tr><td class="thread_sig" align="left" colspan="2"></td></tr>
        	
        </table>
<br />       <a name="post_4613"></a>       
        <table class="forum_posts" cellpadding="0" cellspacing="0" id="fullheight">
            <tr>
                <td width="100%" align="left" colspan="2" valign="top" class="mem_name" id="name_4613" nowrap>
                    <table width="100%" cellpadding="0" cellspacing="0">
                        <tr>
                            <td class="UserNameOptions" width="100%">
                                <ul id="UserNameOptions">
                                  <li>
                                    <div id="mem3" onmouseover="mcancelclosetime()" onmouseout="mclosetime()">
                                        
                                    </div>
                                  </li>
                                </ul>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td align="left" nowrap valign="top" width="20">
                    <table cellpadding="0" cellspacing="0" width="20">
                        <tr>
                            <td class="t_userinfo" width="20" nowrap>
                <!-- member_title --><div class="">Clicked A Few Times</div><!-- /member_title -->
                                
                            </td>
                        </tr>
                    </table>
                </td>
                        
            		<td align="left" width="100%" valign="top" id="fullheight">
		                <table width="100%" cellpadding="0" cellspacing="0" class="post0" height="75">
		                    <tr>
		                        <td class="post_date" valign="bottom" height="1px"  width="100%" colspan="2"  nowrap><a target="blank" href="../sp/id4613.html">1:47:28 AM PDT - Wed, Jun 4th 2014 </a></td>
		                            <td class="post_date" valign="bottom" height="1px" width="100%" nowrap></td>

		                    </tr>
		                    <tr><td valign="top" height="1px" colspan="2">update<hr /></td></tr>                 
		                    <tr>
		                        <td valign="top" class="post_body" height="65" colspan="2">Yesterdays tests were successful, so today I tried enabling threading in MKL (openmp)<br />

<pre>
setenv MKLROOT /apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl
setenv NWCHEM_TARGET LINUX64
setenv BLASOPT &quot;-L/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/lib/intel64  -lmkl_intel_ilp64 -lmkl_core -lmkl_intel_thread -lpthread -lm&quot;
setenv BLAS_LIB &quot;-L/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/lib/intel64  -lmkl_intel_ilp64 -lmkl_core -lmkl_intel_thread -lpthread -lm&quot;
setenv BLAS_SIZE 8
setenv SCALAPACK_SIZE 8
setenv ARMCI_NETWORK OPENIB
setenv FC ifort
setenv CC icc
setenv CXX icpc
setenv FXX ifort
setenv MPI_CXX icpc
setenv MPI_CC icc
setenv MPI_F90 ifort
setenv FOPTIMIZE &quot;-O3  -no-prec-div -funroll-loops&quot;
setenv COPTIMIZE &quot;-O3  -no-prec-div -funroll-loops&quot;
setenv FFLAGS &quot; -i8 -openmp -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include/intel64/ilp64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include&quot;
setenv FOPTIONS &quot; -i8 -openmp -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include/intel64/ilp64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include&quot;
setenv CFLAGS &quot; -DMKL_ILP64 -openmp -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include/intel64/ilp64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include&quot;
setenv COPTIONS &quot; -DMKL_ILP64 -openmp -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include/intel64/ilp64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include&quot;
setenv CXXFLAGS &quot; -DMKL_ILP64 -openmp -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include/intel64/ilp64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include&quot;
setenv CXXOPTIONS &quot; -DMKL_ILP64 -openmp -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include/intel64/ilp64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include&quot;
setenv USE_OPENMP y
</pre><br />
<br />
However, this resulted in a binary that gives segmentation faults. I'll try with more conservative optimisations. <br />
<br />
For the record, this is the full environment settings from build_nwchem<br />
<br />

<pre>
NWCHEM_TOP     = /home/hpc/mptf/mptf21/Prog/nwchem-6.3-lima
NWCHEM_TARGET  = LINUX64
NWCHEM_MODULES = all
USE_MPI        = y
USE_MPIF       = y
USE_MPIF4      = y
MPI_INCLUDE    = -I/apps/OpenMPI/1.7.2-intel13.1/include -I/apps/OpenMPI/1.7.2-intel13.1/lib
MPI_LIB        = -L/apps/OpenMPI/1.7.2-intel13.1/lib
LIBMPI         = -lmpi_usempif08 -lmpi_usempi_ignore_tkr -lmpi_mpifh -lmpi
MPI_F90        = ifort
MPI_CC         = icc
MPI_CXX        = icpc
ARMCI_NETWORK  = OPENIB
MSG_COMMS      = MPI
IB_INCLUDE     = /usr/include
IB_LIB         = /usr/lib64
IB_LIB_NAME    = -libverbs
BLASOPT        = -L/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/lib/intel64 -lmkl_intel_ilp64 -lmkl_core -lmkl_intel_thread -lpthread -lm
</pre>
</td>
		                    </tr>
		                                
		                    
		                    
		                </table>
		            </td>
        </tr> 
           
        <tr><td class="thread_sig" align="left" colspan="2"></td></tr>
        	
        </table>
<br />       <a name="post_4628"></a>       
        <table class="forum_posts" cellpadding="0" cellspacing="0" id="fullheight">
            <tr>
                <td width="100%" align="left" colspan="2" valign="top" class="mem_name" id="name_4628" nowrap>
                    <table width="100%" cellpadding="0" cellspacing="0">
                        <tr>
                            <td class="UserNameOptions" width="100%">
                                <ul id="UserNameOptions">
                                  <li>
                                    <div id="mem4" onmouseover="mcancelclosetime()" onmouseout="mclosetime()">
                                        
                                    </div>
                                  </li>
                                </ul>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td align="left" nowrap valign="top" width="20">
                    <table cellpadding="0" cellspacing="0" width="20">
                        <tr>
                            <td class="t_userinfo" width="20" nowrap>
                <!-- member_title --><div class="">Clicked A Few Times</div><!-- /member_title -->
                                
                            </td>
                        </tr>
                    </table>
                </td>
                        
            		<td align="left" width="100%" valign="top" id="fullheight">
		                <table width="100%" cellpadding="0" cellspacing="0" class="post1" height="75">
		                    <tr>
		                        <td class="post_date" valign="bottom" height="1px"  width="100%" colspan="2"  nowrap><a target="blank" href="../sp/id4628.html">8:42:56 AM PDT - Thu, Jun 5th 2014 </a></td>
		                            <td class="post_date" valign="bottom" height="1px" width="100%" nowrap></td>

		                    </tr>
		                    <tr><td valign="top" height="1px" colspan="2">Comparing armci comex threading and PHI<hr /></td></tr>                 
		                    <tr>
		                        <td valign="top" class="post_body" height="65" colspan="2">After the QA tests (which I recommend comparing by hand, sometimes the "Failure" is a false alarm) I've done a small and straightforward benchmark using only 1 node, and I find the results surprising <br />
<br />
<br />
Average timings for "armci" "armci+openmp" and "comex" libraries. Exactly the same job script. SCF + DFT energy job in a medium sized system. 1 node (40 processors, 64 gb ram), 10 processors used, OMP_NUM_THREADS=4 when applicable. <br />

<pre>
Time 
armci                   &nbsp;:Total times  cpu:     6401.5s     wall:     6414.5s
armci + openmp   &nbsp;:Total times  cpu:     6649.3s     wall:     6382.4s
comex                 &nbsp;:Total times  cpu:    31301.5s     wall:    31351.1s
armci + openmp with phi  &nbsp;:Total times  cpu:     6610.3s     wall:     6352.4s
</pre><br />
<br />
1. Nothing is offloaded to the phi card<br />
2. A sampling of the process for 15 minutes showed no threading. At least dgemm should have threaded within this time period. <br />
3. COMEX binary in a single node is extremely slow  (~5x)<br />
<br />
I really don't know what went wrong. The binary seems to contain correct references, but are they called?  <br />
<br />
Is it normal for COMEX to be this slow? <br />
<br />
<br />
Environment settings for Intel MIC automatic offload<br />

<pre>
OFFLOAD_REPORT=2
MKL_MIC_ENABLE=1
</pre>
</td>
		                    </tr>
		                                
		                    <tr>
	<td class="edited_on" align="left" colspan="2">
	</td>
</tr>
		                    
		                </table>
		            </td>
        </tr> 
           
        <tr><td class="thread_sig" align="left" colspan="2"></td></tr>
        	
        </table>
<br />       <a name="post_4629"></a>       
        <table class="forum_posts" cellpadding="0" cellspacing="0" id="fullheight">
            <tr>
                <td width="100%" align="left" colspan="2" valign="top" class="mem_name" id="name_4629" nowrap>
                    <table width="100%" cellpadding="0" cellspacing="0">
                        <tr>
                            <td class="UserNameOptions" width="100%">
                                <ul id="UserNameOptions">
                                  <li>
                                    <div id="mem5" onmouseover="mcancelclosetime()" onmouseout="mclosetime()">
                                        
                                    </div>
                                  </li>
                                </ul>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td align="left" nowrap valign="top" width="20">
                    <table cellpadding="0" cellspacing="0" width="20">
                        <tr>
                            <td class="t_userinfo" width="20" nowrap>
                <!-- member_title --><div class="">Clicked A Few Times</div><!-- /member_title -->
                                
                            </td>
                        </tr>
                    </table>
                </td>
                        
            		<td align="left" width="100%" valign="top" id="fullheight">
		                <table width="100%" cellpadding="0" cellspacing="0" class="post0" height="75">
		                    <tr>
		                        <td class="post_date" valign="bottom" height="1px"  width="100%" colspan="2"  nowrap><a target="blank" href="../sp/id4629.html">8:46:07 AM PDT - Thu, Jun 5th 2014 </a></td>
		                            <td class="post_date" valign="bottom" height="1px" width="100%" nowrap></td>

		                    </tr>
		                    <tr><td valign="top" height="1px" colspan="2">Environment settings used in compiling "comex" binary<hr /></td></tr>                 
		                    <tr>
		                        <td valign="top" class="post_body" height="65" colspan="2">Environment settings used in compiling "comex" binary<br />

<pre>
setenv MKLROOT /apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl
setenv NWCHEM_TARGET LINUX64
setenv BLASOPT &quot;-L/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/lib/intel64 -lmkl_intel_ilp64 -lmkl_sequential -lmkl_core -lpthread -lm&quot;
setenv BLAS_LIB &quot;-L/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/lib/intel64 -lmkl_intel_ilp64 -lmkl_sequential -lmkl_core -lpthread -lm&quot;
setenv BLAS_SIZE 8
setenv SCALAPACK_SIZE 8
setenv ARMCI_NETWORK MPI-TS
setenv FC ifort
setenv CC icc
setenv CXX icpc
setenv FXX ifort
setenv MPI_CXX icpc
setenv MPI_CC icc
setenv MPI_F90 ifort
setenv FOPTIMIZE &quot;-O3 -xavx -no-prec-div -funroll-loops&quot;
setenv COPTIMIZE &quot;-O3 -xavx -no-prec-div -funroll-loops&quot;
setenv FFLAGS &quot; -i8 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include/intel64/ilp64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include&quot;
setenv FOPTIONS &quot; -i8 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include/intel64/ilp64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include&quot;
setenv CFLAGS &quot; -DMKL_ILP64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include/intel64/ilp64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include&quot;
setenv COPTIONS &quot; -DMKL_ILP64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include/intel64/ilp64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include&quot;
setenv CXXFLAGS &quot; -DMKL_ILP64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include/intel64/ilp64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include&quot;
setenv CXXOPTIONS &quot; -DMKL_ILP64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include/intel64/ilp64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include&quot;
setenv NWCHEM_MODULES all
</pre>
</td>
		                    </tr>
		                                
		                    
		                    
		                </table>
		            </td>
        </tr> 
           
        <tr><td class="thread_sig" align="left" colspan="2"></td></tr>
        	
        </table>
<br />       <a name="post_4630"></a>       
        <table class="forum_posts" cellpadding="0" cellspacing="0" id="fullheight">
            <tr>
                <td width="100%" align="left" colspan="2" valign="top" class="mem_name" id="name_4630" nowrap>
                    <table width="100%" cellpadding="0" cellspacing="0">
                        <tr>
                            <td class="UserNameOptions" width="100%">
                                <ul id="UserNameOptions">
                                  <li>
                                    <div id="mem6" onmouseover="mcancelclosetime()" onmouseout="mclosetime()">
                                        
                                    </div>
                                  </li>
                                </ul>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td align="left" nowrap valign="top" width="20">
                    <table cellpadding="0" cellspacing="0" width="20">
                        <tr>
                            <td class="t_userinfo" width="20" nowrap>
                <!-- member_title --><div class="">Clicked A Few Times</div><!-- /member_title -->
                                
                            </td>
                        </tr>
                    </table>
                </td>
                        
            		<td align="left" width="100%" valign="top" id="fullheight">
		                <table width="100%" cellpadding="0" cellspacing="0" class="post1" height="75">
		                    <tr>
		                        <td class="post_date" valign="bottom" height="1px"  width="100%" colspan="2"  nowrap><a target="blank" href="../sp/id4630.html">8:46:59 AM PDT - Thu, Jun 5th 2014 </a></td>
		                            <td class="post_date" valign="bottom" height="1px" width="100%" nowrap></td>

		                    </tr>
		                    <tr><td valign="top" height="1px" colspan="2">Environment settings used in compiling "armci+openmp" binary (openib drivers are used)<hr /></td></tr>                 
		                    <tr>
		                        <td valign="top" class="post_body" height="65" colspan="2"><pre>
setenv MKLROOT /apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl
setenv NWCHEM_TARGET LINUX64
setenv BLAS_LIB &quot;-L/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/lib/intel64 -lmkl_intel_ilp64 -lmkl_core -lmkl_intel_thread -lpthread -lm&quot;
setenv LAPACK_LIB &quot;-L/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/lib/intel64 -lmkl_intel_ilp64 -lmkl_core -lmkl_intel_thread -lpthread -lm&quot;
setenv BLAS_SIZE 8
setenv LAPACK_SIZE 8
setenv SCALAPACK_SIZE 8
setenv ARMCI_NETWORK OPENIB
setenv FC ifort
setenv CC icc
setenv CXX icpc
setenv FXX ifort
setenv MPI_CXX icpc
setenv MPI_CC icc
setenv MPI_F90 ifort
setenv FOPTIMIZE &quot;-O3 -openmp -xavx -no-prec-div -funroll-loops&quot;
setenv COPTIMIZE &quot;-O3 -openmp -xavx -no-prec-div -funroll-loops&quot;
setenv FFLAGS &quot; -i8 -openmp -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include/intel64/ilp64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include&quot;
setenv FOPTIONS &quot; -i8 -openmp -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include/intel64/ilp64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include&quot;
setenv CFLAGS &quot; -DMKL_ILP64 -openmp -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include/intel64/ilp64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include&quot;
setenv COPTIONS &quot; -DMKL_ILP64 -openmp -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include/intel64/ilp64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include&quot;
setenv CXXFLAGS &quot; -DMKL_ILP64 -openmp -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include/intel64/ilp64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include&quot;
setenv CXXOPTIONS &quot; -DMKL_ILP64 -openmp -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include/intel64/ilp64 -I/apps/intel/ComposerXE2013/composer_xe_2013.5.192/mkl/include&quot;
setenv USE_OPENMP y
setenv NWCHEM_MODULES all
setenv USE_MPI y
setenv USE_MPIF y
setenv USE_MPIF4 y
setenv MPI_INCLUDE &quot;-I/apps/OpenMPI/1.6.5-intel13.1/include -I/apps/OpenMPI/1.6.5-intel13.1/lib&quot;
setenv MPI_LIB -L/apps/OpenMPI/1.6.5-intel13.1/lib
setenv LIBMPI &quot;-lmpi_f90 -lmpi_f77 -lmpi -ldl -lm -lrt -lnsl -lutil&quot;
setenv ARMCI_NETWORK OPENIB
setenv MSG_COMMS MPI
setenv IB_INCLUDE /usr/include
setenv IB_LIB /usr/lib64
setenv IB_LIB_NAME -libverbs
</pre>
</td>
		                    </tr>
		                                
		                    
		                    
		                </table>
		            </td>
        </tr> 
           
        <tr><td class="thread_sig" align="left" colspan="2"></td></tr>
        	
        </table>
<br />       <a name="post_4631"></a>       
        <table class="forum_posts" cellpadding="0" cellspacing="0" id="fullheight">
            <tr>
                <td width="100%" align="left" colspan="2" valign="top" class="mem_name" id="name_4631" nowrap>
                    <table width="100%" cellpadding="0" cellspacing="0">
                        <tr>
                            <td class="UserNameOptions" width="100%">
                                <ul id="UserNameOptions">
                                  <li>
                                    <div id="mem7" onmouseover="mcancelclosetime()" onmouseout="mclosetime()">
                                        
                                    </div>
                                  </li>
                                </ul>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td align="left" nowrap valign="top" width="20">
                    <table cellpadding="0" cellspacing="0" width="20">
                        <tr>
                            <td class="t_userinfo" width="20" nowrap>
                <!-- member_title --><div class="">Clicked A Few Times</div><!-- /member_title -->
                                
                            </td>
                        </tr>
                    </table>
                </td>
                        
            		<td align="left" width="100%" valign="top" id="fullheight">
		                <table width="100%" cellpadding="0" cellspacing="0" class="post0" height="75">
		                    <tr>
		                        <td class="post_date" valign="bottom" height="1px"  width="100%" colspan="2"  nowrap><a target="blank" href="../sp/id4631.html">8:47:13 AM PDT - Thu, Jun 5th 2014 </a></td>
		                            <td class="post_date" valign="bottom" height="1px" width="100%" nowrap></td>

		                    </tr>
		                    <tr><td valign="top" height="1px" colspan="2">-<hr /></td></tr>                 
		                    <tr>
		                        <td valign="top" class="post_body" height="65" colspan="2">-
</td>
		                    </tr>
		                                
		                    <tr>
	<td class="edited_on" align="left" colspan="2">
	</td>
</tr>
		                    
		                </table>
		            </td>
        </tr> 
           
        <tr><td class="thread_sig" align="left" colspan="2"></td></tr>
        	
        </table>
<br />       <a name="post_4640"></a>       
        <table class="forum_posts" cellpadding="0" cellspacing="0" id="fullheight">
            <tr>
                <td width="100%" align="left" colspan="2" valign="top" class="mem_name" id="name_4640" nowrap>
                    <table width="100%" cellpadding="0" cellspacing="0">
                        <tr>
                            <td class="UserNameOptions" width="100%">
                                <ul id="UserNameOptions">
                                  <li>
                                    <div id="mem8" onmouseover="mcancelclosetime()" onmouseout="mclosetime()">
                                        
                                    </div>
                                  </li>
                                </ul>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td align="left" nowrap valign="top" width="20">
                    <table cellpadding="0" cellspacing="0" width="20">
                        <tr>
                            <td class="t_userinfo" width="20" nowrap>
                <!-- member_title --><div class="">Clicked A Few Times</div><!-- /member_title -->
                                
                            </td>
                        </tr>
                    </table>
                </td>
                        
            		<td align="left" width="100%" valign="top" id="fullheight">
		                <table width="100%" cellpadding="0" cellspacing="0" class="post1" height="75">
		                    <tr>
		                        <td class="post_date" valign="bottom" height="1px"  width="100%" colspan="2"  nowrap><a target="blank" href="../sp/id4640.html">5:06:19 AM PDT - Fri, Jun 6th 2014 </a></td>
		                            <td class="post_date" valign="bottom" height="1px" width="100%" nowrap></td>

		                    </tr>
		                    <tr><td valign="top" height="1px" colspan="2">Single node straightforward benchmarks for comex-ofa mpi-pr and mpi-spawn<hr /></td></tr>                 
		                    <tr>
		                        <td valign="top" class="post_body" height="65" colspan="2">The same settings above, with new ARMCI_NETWORK settings. <br />
<br />

<pre>
armci-openmp:Total times  cpu:     6649.3s     wall:     6382.4s
comex-ofa:Total times  cpu:     6801.7s     wall:     6445.6s
mpi-spawn:Total times  cpu:     6718.9s     wall:     6483.8s
mpi-pr:Total times  cpu:     6667.2s     wall:     6428.9s
</pre><br />
<br />
These communication methods seem to provide a performance-wise viable alternative if you are having issues with ARMCI_DEFAULT_SHMMAX
</td>
		                    </tr>
		                                
		                    
		                    
		                </table>
		            </td>
        </tr> 
           
        <tr><td class="thread_sig" align="left" colspan="2"></td></tr>
        	
        </table>
<br />       <a name="post_4699"></a>       
        <table class="forum_posts" cellpadding="0" cellspacing="0" id="fullheight">
            <tr>
                <td width="100%" align="left" colspan="2" valign="top" class="mem_name" id="name_4699" nowrap>
                    <table width="100%" cellpadding="0" cellspacing="0">
                        <tr>
                            <td class="UserNameOptions" width="100%">
                                <ul id="UserNameOptions">
                                  <li>
                                    <div id="mem9" onmouseover="mcancelclosetime()" onmouseout="mclosetime()">
                                        
                                    </div>
                                  </li>
                                </ul>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td align="left" nowrap valign="top" width="20">
                    <table cellpadding="0" cellspacing="0" width="20">
                        <tr>
                            <td class="t_userinfo" width="20" nowrap>
                <!-- member_title --><div class="">Clicked A Few Times</div><!-- /member_title -->
                                
                            </td>
                        </tr>
                    </table>
                </td>
                        
            		<td align="left" width="100%" valign="top" id="fullheight">
		                <table width="100%" cellpadding="0" cellspacing="0" class="post0" height="75">
		                    <tr>
		                        <td class="post_date" valign="bottom" height="1px"  width="100%" colspan="2"  nowrap><a target="blank" href="../sp/id4699.html">1:57:57 AM PDT - Sat, Jun 21st 2014 </a></td>
		                            <td class="post_date" valign="bottom" height="1px" width="100%" nowrap></td>

		                    </tr>
		                    <tr><td valign="top" height="1px" colspan="2">Successful scalapack compilation<hr /></td></tr>                 
		                    <tr>
		                        <td valign="top" class="post_body" height="65" colspan="2">This is a corner cutting method. Perhaps a better way exists. <br />

<ul><li>Intel MKL 11 or newer scalapack cause strange segmentation faults with Openmpi 1.6-1.8. These segmentation faults do not appear with intel mpi. <br />
</li><li>build_nwchem script overrides my settings, I'll not use it anymore.<br />
</li><li>I edited config/makefile.h so that intel compiler settings are applied to mpif90  <br />
</li><li>QA tests in single cpu still run 10 times faster than my fastest binary, and my binary is much faster than the binary supplied with ubuntu for example. How do they achieve that performance? <br />
</li><li>To Do Next: In order to compile nwchem for the mic card, I have to somehow cross compile ga, or make nwchem accept a cross compiled one. <br />
</li></ul>
<br />
The following settings work, and pass QA tests when compiled with <br />

<pre>source settings.csh;cd src;make nwchem_config;make CC=mpicc FC=mpif90 CXX=mpicxx<br />
</pre>
settings.csh:<br />

<pre>
module purge
module load intelmpi/4.1.3.048-intel intel64/13.1up03

setenv NWCHEM_TARGET LINUX64
setenv NWCHEM_TOP /wherever nwchem sits, but name shortened from default/
setenv MPI_ROOT /wherever intel sits/intel/mpi/4.1.3.048/include64/

setenv LAPACK_LIB &quot;-L$MKLROOT/lib/intel64 -lmkl_scalapack_ilp64 -lmkl_intel_ilp64 -lmkl_core -lmkl_intel_thread -lmkl_blacs_intelmpi_ilp64 -lpthread -lm&quot;
setenv BLAS_LIB &quot;-L$MKLROOT/lib/intel64 -lmkl_scalapack_ilp64 -lmkl_intel_ilp64 -lmkl_core -lmkl_intel_thread -lmkl_blacs_intelmpi_ilp64 -lpthread -lm&quot;
setenv SCALAPACK_LIB &quot;-L$MKLROOT/lib/intel64 -lmkl_scalapack_ilp64 -lmkl_intel_ilp64 -lmkl_core -lmkl_intel_thread -lmkl_blacs_intelmpi_ilp64 -lpthread -lm&quot;
setenv BLASOPT &quot;-L$MKLROOT/lib/intel64 -lmkl_scalapack_ilp64 -lmkl_intel_ilp64 -lmkl_core -lmkl_intel_thread -lmkl_blacs_intelmpi_ilp64 -lpthread -lm&quot;
setenv USE_SCALAPACK_I8 y
setenv BLAS_SIZE 8
setenv LAPACK_SIZE 8
setenv SCALAPACK_SIZE 8
setenv FC ifort
setenv CC icc
setenv CXX icpc
setenv FXX ifort
setenv MPI_CXX icpc
setenv MPI_CC icc
setenv MPI_F90 ifort
setenv FOPTIMIZE &quot;-O3 -openmp -static-intel  -no-prec-div -funroll-loops&quot;
setenv COPTIMIZE &quot;-O3 -openmp -static-intel  -no-prec-div -funroll-loops&quot;
setenv FFLAGS &quot; -i8 -openmp -static-intel -I$MKLROOT/include/intel64/ilp64 -I$MKLROOT/include&quot;
setenv FOPTIONS &quot; -i8 -openmp -static-intel -I$MKLROOT/include/intel64/ilp64 -I$MKLROOT/include&quot;
setenv CFLAGS &quot; -DMKL_ILP64 -openmp -static-intel -ftz -I$MKLROOT/include/intel64/ilp64 -I$MKLROOT/include&quot;
setenv CFLAGS_FORGA &quot; -DMKL_ILP64 -ftz -openmp -static-intel -I$MKLROOT/include/intel64/ilp64 -I$MKLROOT/include&quot;
setenv COPTIONS &quot; -DMKL_ILP64 -ftz -openmp -static-intel -I$MKLROOT/include/intel64/ilp64 -I$MKLROOT/include&quot;
setenv CXXFLAGS &quot; -DMKL_ILP64 -ftz -openmp -static-intel -I$MKLROOT/include/intel64/ilp64 -I$MKLROOT/include&quot;
setenv CXXOPTIONS &quot; -DMKL_ILP64 -ftz -openmp -static-intel -st-I$MKLROOT/include/intel64/ilp64 -I$MKLROOT/include&quot;
setenv USE_OPENMP y
setenv NWCHEM_MODULES all
setenv USE_MPI y
setenv USE_MPIF y
setenv USE_MPIF4 y
setenv MPI_INCLUDE &quot;-I$MPI_ROOT/include64 -I$MPI_ROOT/lib64&quot;
setenv MPI_LIB -L$MPI_ROOT/lib
setenv LIBMPI &quot;-lmpi_f90 -lmpi_f77 -lmpi -ldl -lm -lrt -lnsl -lutil&quot;
setenv ARMCI_NETWORK OFA
setenv MSG_COMMS MPI
#Following settings are often true for IB Linux clusters
setenv IB_INCLUDE /usr/include
setenv IB_LIB /usr/lib64
setenv IB_LIB_NAME -libverbs
</pre>
</td>
		                    </tr>
		                                
		                    
		                    
		                </table>
		            </td>
        </tr> 
           
        <tr><td class="thread_sig" align="left" colspan="2"></td></tr>
        	
        </table>
<br />       <a name="post_4700"></a>       
        <table class="forum_posts" cellpadding="0" cellspacing="0" id="fullheight">
            <tr>
                <td width="100%" align="left" colspan="2" valign="top" class="mem_name" id="name_4700" nowrap>
                    <table width="100%" cellpadding="0" cellspacing="0">
                        <tr>
                            <td class="UserNameOptions" width="100%">
                                <ul id="UserNameOptions">
                                  <li>
                                    <div id="mem10" onmouseover="mcancelclosetime()" onmouseout="mclosetime()">
                                        
                                    </div>
                                  </li>
                                </ul>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td align="left" nowrap valign="top" width="20">
                    <table cellpadding="0" cellspacing="0" width="20">
                        <tr>
                            <td class="t_userinfo" width="20" nowrap>
                <!-- member_title --><div class="">Gets Around</div><!-- /member_title -->
                                
                            </td>
                        </tr>
                    </table>
                </td>
                        
            		<td align="left" width="100%" valign="top" id="fullheight">
		                <table width="100%" cellpadding="0" cellspacing="0" class="post1" height="75">
		                    <tr>
		                        <td class="post_date" valign="bottom" height="1px"  width="100%" colspan="2"  nowrap><a target="blank" href="../sp/id4700.html">6:57:01 PM PDT - Sat, Jun 21st 2014 </a></td>
		                            <td class="post_date" valign="bottom" height="1px" width="100%" nowrap></td>

		                    </tr>
		                                     
		                    <tr>
		                        <td valign="top" class="post_body" height="65" colspan="2"><i>QA tests in single cpu still run 10 times faster than my fastest binary, and my binary is much faster than the binary supplied with ubuntu for example. How do they achieve that performance?</i><br />
<br />
Which QA tests? If they are tests with significant disk I/O that can dominate wall clock time. It's possible that the single-processor QA outputs were generated on systems with fast scratch disk, like a RAID system, SSD, or (even faster) something like Lustre running over a fast network.
</td>
		                    </tr>
		                                
		                    
		                    
		                </table>
		            </td>
        </tr> 
           
        <tr><td class="thread_sig" align="left" colspan="2"></td></tr>
        	
        </table>
<br />       <a name="post_4701"></a>       
        <table class="forum_posts" cellpadding="0" cellspacing="0" id="fullheight">
            <tr>
                <td width="100%" align="left" colspan="2" valign="top" class="mem_name" id="name_4701" nowrap>
                    <table width="100%" cellpadding="0" cellspacing="0">
                        <tr>
                            <td class="UserNameOptions" width="100%">
                                <ul id="UserNameOptions">
                                  <li>
                                    <div id="mem11" onmouseover="mcancelclosetime()" onmouseout="mclosetime()">
                                        
                                    </div>
                                  </li>
                                </ul>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td align="left" nowrap valign="top" width="20">
                    <table cellpadding="0" cellspacing="0" width="20">
                        <tr>
                            <td class="t_userinfo" width="20" nowrap>
                <!-- member_title --><div class="">Clicked A Few Times</div><!-- /member_title -->
                                
                            </td>
                        </tr>
                    </table>
                </td>
                        
            		<td align="left" width="100%" valign="top" id="fullheight">
		                <table width="100%" cellpadding="0" cellspacing="0" class="post0" height="75">
		                    <tr>
		                        <td class="post_date" valign="bottom" height="1px"  width="100%" colspan="2"  nowrap><a target="blank" href="../sp/id4701.html">8:43:14 PM PDT - Sat, Jun 21st 2014 </a></td>
		                            <td class="post_date" valign="bottom" height="1px" width="100%" nowrap></td>

		                    </tr>
		                    <tr><td valign="top" height="1px" colspan="2">details<hr /></td></tr>                 
		                    <tr>
		                        <td valign="top" class="post_body" height="65" colspan="2"><div class='quote_title'>Quote:Mernst <a target='blank' href="../sp/id4700.html" title="Special_AWCforum/sp/id4700">Jun 22nd 1:57 am</a><div class='quote'><i><br />
<br />
Which QA tests? If they are tests with significant disk I/O that can dominate wall clock time. It's possible that the single-processor QA outputs were generated on systems with fast scratch disk, like a RAID system, SSD, or (even faster) something like Lustre running over a fast network.</i></div id="quote"></div id="quote"><br />
<br />
Hi Mernst, <br />
<br />
All of them<br />
<br />
For example h2o_cg_to_diag_ub3lyp. The test quotes 1.0 seconds, while mine took 14 seconds. This is a very serious difference. <br />
<br />
I am working on a hardware Lustre. As far as I can see, system wait is negligible in most of the cases. The cpu is an Ivy-Bridge Xeon. <br />
<br />
I think it is the global arrays, but I don't understand why it is so slow.
</td>
		                    </tr>
		                                
		                    
		                    
		                </table>
		            </td>
        </tr> 
           
        <tr><td class="thread_sig" align="left" colspan="2"></td></tr>
        	
        </table>
<br />       <a name="post_4702"></a>       
        <table class="forum_posts" cellpadding="0" cellspacing="0" id="fullheight">
            <tr>
                <td width="100%" align="left" colspan="2" valign="top" class="mem_name" id="name_4702" nowrap>
                    <table width="100%" cellpadding="0" cellspacing="0">
                        <tr>
                            <td class="UserNameOptions" width="100%">
                                <ul id="UserNameOptions">
                                  <li>
                                    <div id="mem12" onmouseover="mcancelclosetime()" onmouseout="mclosetime()">
                                        
                                    </div>
                                  </li>
                                </ul>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td align="left" nowrap valign="top" width="20">
                    <table cellpadding="0" cellspacing="0" width="20">
                        <tr>
                            <td class="t_userinfo" width="20" nowrap>
                <!-- member_title --><div class="">Gets Around</div><!-- /member_title -->
                                
                            </td>
                        </tr>
                    </table>
                </td>
                        
            		<td align="left" width="100%" valign="top" id="fullheight">
		                <table width="100%" cellpadding="0" cellspacing="0" class="post1" height="75">
		                    <tr>
		                        <td class="post_date" valign="bottom" height="1px"  width="100%" colspan="2"  nowrap><a target="blank" href="../sp/id4702.html">10:11:13 PM PDT - Sat, Jun 21st 2014 </a></td>
		                            <td class="post_date" valign="bottom" height="1px" width="100%" nowrap></td>

		                    </tr>
		                                     
		                    <tr>
		                        <td valign="top" class="post_body" height="65" colspan="2">Hi Obm,<br />
<br />
That performance is pretty dire. h2o_cg_to_diag_ub3lyp finishes in 0.5 seconds for me, using the June 2014 dev snapshot on a 2.4 GHz Ivy Bridge i7. I'm running Ubuntu 14.04 and I built NWChem using the gnu compilers and OpenBLAS 0.28.<br />
<br />
You said that your binary runs faster than the one supplied by Ubuntu? Even the unoptimized Ubuntu package I'd expect to take a second or less on that test on a modern Xeon. In my experience the default Ubuntu package performs close to a good build with the gnu compilers unless you're running post-HF calculations, where the BLAS really starts to matter and the performance gap widens. A build with the Intel compilers and MKL and no special changes is faster but by less than a factor of two.
</td>
		                    </tr>
		                                
		                    <tr>
	<td class="edited_on" align="left" colspan="2">
	</td>
</tr>
		                    
		                </table>
		            </td>
        </tr> 
           
        <tr><td class="thread_sig" align="left" colspan="2"></td></tr>
        	
        </table>
<br />       <a name="post_4704"></a>       
        <table class="forum_posts" cellpadding="0" cellspacing="0" id="fullheight">
            <tr>
                <td width="100%" align="left" colspan="2" valign="top" class="mem_name" id="name_4704" nowrap>
                    <table width="100%" cellpadding="0" cellspacing="0">
                        <tr>
                            <td class="UserNameOptions" width="100%">
                                <ul id="UserNameOptions">
                                  <li>
                                    <div id="mem13" onmouseover="mcancelclosetime()" onmouseout="mclosetime()">
                                        
                                    </div>
                                  </li>
                                </ul>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td align="left" nowrap valign="top" width="20">
                    <table cellpadding="0" cellspacing="0" width="20">
                        <tr>
                            <td class="t_userinfo" width="20" nowrap>
                <!-- member_title --><div class="">Clicked A Few Times</div><!-- /member_title -->
                                
                            </td>
                        </tr>
                    </table>
                </td>
                        
            		<td align="left" width="100%" valign="top" id="fullheight">
		                <table width="100%" cellpadding="0" cellspacing="0" class="post0" height="75">
		                    <tr>
		                        <td class="post_date" valign="bottom" height="1px"  width="100%" colspan="2"  nowrap><a target="blank" href="../sp/id4704.html">2:32:41 AM PDT - Mon, Jun 23rd 2014 </a></td>
		                            <td class="post_date" valign="bottom" height="1px" width="100%" nowrap></td>

		                    </tr>
		                                     
		                    <tr>
		                        <td valign="top" class="post_body" height="65" colspan="2"><div class='quote_title'>Quote:Mernst <a target='blank' href="../sp/id4702.html" title="Special_AWCforum/sp/id4702">Jun 22nd 5:11 am</a><div class='quote'><br />
I'd expect to take a second or less on that test on a modern Xeon. In my experience the default Ubuntu package performs close to a good build with the gnu compilers unless you're running post-HF calculations, where the BLAS really starts to matter and the performance gap widens. A build with the Intel compilers and MKL and no special changes is faster but by less than a factor of two.</div id="quote"></div id="quote"><br />
<br />
Good morning Mernst, <br />
May I ask if you are using 64 bit integers? (INTERFACE64 = 1 in OpenBLAS) Which global arrays version and message passing interface? I am curious, and setting up some timings comparing intel mpi/mkl/compilers with openmpi/gcc/openBLAS now. I will use 64 bit interface on both, with message passing set to mpi-spawn. (I can not set this to openIB sadly)
</td>
		                    </tr>
		                                
		                    
		                    
		                </table>
		            </td>
        </tr> 
           
        <tr><td class="thread_sig" align="left" colspan="2"></td></tr>
        	
        </table>
<br />       <a name="post_4705"></a>       
        <table class="forum_posts" cellpadding="0" cellspacing="0" id="fullheight">
            <tr>
                <td width="100%" align="left" colspan="2" valign="top" class="mem_name" id="name_4705" nowrap>
                    <table width="100%" cellpadding="0" cellspacing="0">
                        <tr>
                            <td class="UserNameOptions" width="100%">
                                <ul id="UserNameOptions">
                                  <li>
                                    <div id="mem14" onmouseover="mcancelclosetime()" onmouseout="mclosetime()">
                                        
                                    </div>
                                  </li>
                                </ul>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td align="left" nowrap valign="top" width="20">
                    <table cellpadding="0" cellspacing="0" width="20">
                        <tr>
                            <td class="t_userinfo" width="20" nowrap>
                <!-- member_title --><div class="">Clicked A Few Times</div><!-- /member_title -->
                                
                            </td>
                        </tr>
                    </table>
                </td>
                        
            		<td align="left" width="100%" valign="top" id="fullheight">
		                <table width="100%" cellpadding="0" cellspacing="0" class="post1" height="75">
		                    <tr>
		                        <td class="post_date" valign="bottom" height="1px"  width="100%" colspan="2"  nowrap><a target="blank" href="../sp/id4705.html">7:39:12 AM PDT - Mon, Jun 23rd 2014 </a></td>
		                            <td class="post_date" valign="bottom" height="1px" width="100%" nowrap></td>

		                    </tr>
		                    <tr><td valign="top" height="1px" colspan="2">Test input and nwchem timings<hr /></td></tr>                 
		                    <tr>
		                        <td valign="top" class="post_body" height="65" colspan="2">Test input:<br />

<pre>
START test2
TITLE &quot;test 2&quot;
memory global 64000 mb stack 2000 mb heap 1500 mb
GEOMETRY &quot;large&quot; noautoz
N                    -1.18815305     1.64295245    -0.19797254
N                    -1.71429898    -1.23789933     0.05187672
N                     1.71919840     1.24204116    -0.04004607
N                     1.19329270    -1.63905228     0.20931043
C                    -3.39234141     0.55140590    -0.18307121
C                    -2.55116767     1.67114843    -0.25656255
C                    -3.00650182    -0.78302079    -0.04065810
C                    -0.78925710     2.94324537    -0.30799030
C                    -1.68501065    -2.60423235     0.18366171
C                     0.53998837     3.39037732    -0.29831220
C                    -0.53479978    -3.38669954     0.30417660
C                    -3.04194847     3.03938524    -0.40944075
C                    -3.85584599    -1.93945436     0.03744348
H                    -4.46487217     0.73318080    -0.24273597
C                     1.69012467     2.60775608    -0.17760069
C                     0.79430625    -2.93942407     0.31589108
C                    -1.93904510     3.83567875    -0.44172139
C                    -3.05192907    -3.04745551     0.17375667
C                     3.39754200    -0.54765268     0.18864429
C                     3.01155038     0.78677082     0.04679689
C                     2.55630718    -1.66722017     0.26450348
H                     0.70250333     4.46305355    -0.39769395
H                    -0.69671819    -4.45989306     0.39874007
C                     3.05714314     3.05037064    -0.17603592
C                     1.94447052    -3.83227883     0.44539478
C                     3.86123572     1.94232936    -0.03987541
C                     3.04726942    -3.03598779     0.41290904
H                     4.47027977    -0.72966109     0.24346725
H                    -4.08659494     3.33147621    -0.48103833
H                    -4.94025155    -1.90798531    -0.00573877
H                    -1.89101055     4.91670010    -0.54524164
H                    -3.36116456    -4.08450190     0.26140222
H                     3.36594506     4.08689492    -0.27078111
H                     1.89662799    -4.91366014     0.54552638
H                     4.94587903     1.90997603    -0.00360067
H                     4.09206136    -3.32832389     0.48106937
H                    -0.89115074    -0.64366149     0.02720520
H                     0.89618219     0.64803626    -0.01343957
END
BASIS &quot;medium&quot; SPHERICAL
 * library 6-31+g*
END


echo
###################Production run
set &quot;ao basis&quot; &quot;medium&quot;
set geometry &quot;large&quot;
SCF
 vectors output test2.movecs
END

DFT
 iterations 100
 decomp
 direct
 XC b3lyp
 vectors input  test2.movecs
 vectors output test2.movecs
END

TASK SCF ENERGY
TASK DFT ENERGY
</pre><br />
Run: <br />

<pre>mpirun -np 40 (all the processors in the node)<br />
</pre>
Timings (as reported by nwchem):<br />

<pre>Intel scalapack:Total times  cpu:      432.4s     wall:      452.3s<br />
GCC + openBLAS:Total times  cpu:      833.7s     wall:      929.8s
</pre></td>
		                    </tr>
		                                
		                    
		                    
		                </table>
		            </td>
        </tr> 
           
        <tr><td class="thread_sig" align="left" colspan="2"></td></tr>
        	
        </table>
<br />       <a name="post_4707"></a>       
        <table class="forum_posts" cellpadding="0" cellspacing="0" id="fullheight">
            <tr>
                <td width="100%" align="left" colspan="2" valign="top" class="mem_name" id="name_4707" nowrap>
                    <table width="100%" cellpadding="0" cellspacing="0">
                        <tr>
                            <td class="UserNameOptions" width="100%">
                                <ul id="UserNameOptions">
                                  <li>
                                    <div id="mem15" onmouseover="mcancelclosetime()" onmouseout="mclosetime()">
                                        
                                    </div>
                                  </li>
                                </ul>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td align="left" nowrap valign="top" width="20">
                    <table cellpadding="0" cellspacing="0" width="20">
                        <tr>
                            <td class="t_userinfo" width="20" nowrap>
                <!-- member_title --><div class="">Gets Around</div><!-- /member_title -->
                                
                            </td>
                        </tr>
                    </table>
                </td>
                        
            		<td align="left" width="100%" valign="top" id="fullheight">
		                <table width="100%" cellpadding="0" cellspacing="0" class="post0" height="75">
		                    <tr>
		                        <td class="post_date" valign="bottom" height="1px"  width="100%" colspan="2"  nowrap><a target="blank" href="../sp/id4707.html">2:48:48 PM PDT - Mon, Jun 23rd 2014 </a></td>
		                            <td class="post_date" valign="bottom" height="1px" width="100%" nowrap></td>

		                    </tr>
		                                     
		                    <tr>
		                        <td valign="top" class="post_body" height="65" colspan="2">Obm,<br />
<br />
I am using the 64 bit integer interface to OpenBLAS, and I have compiled OpenBLAS without threading (USE_THREAD=0) for NWChem.<br />
<br />
Between several BLAS-linked programs I use, some prefer the 32 bit integer interface, some prefer 64 bit, and some prefer threads on or off. I actually have all 4 permutations of OpenBLAS threading and integer size installed, and I use wrapper scripts that set LD_LIBRARY_PATH to make sure that each program finds its preferred OpenBLAS variant.<br />
<br />
I am using the default openmpi 1.6.5 that is packaged for Ubuntu 14.04.<br />
<br />
I am using the bundled Global Arrays that came with the June 2014 NWChem snapshot: <a target='blank' href="http://nwchemgit.github.io/download.php?f=Nwchem-dev.revision25716-src.2014-06-09.tar.gz" class="external free">http://nwchemgit.github.io/download.php?f=Nwchem-dev.revision25716-src.2014-06-09.tar.gz</a><br />
<br />
The bundled GA is svn revision 10496 of Global Arrays, but I don't know what official version number that corresponds to because I can't view the svn repository for Global Arrays. My ARMCI_NETWORK=SOCKETS.<br />
<br />
I only have 4 physical cores -- I run NWChem on a laptop -- and this was the timing I saw for your test input above running on 4 cores:<br />
<br />
Total times  cpu:     3428.8s     wall:     3442.3s<br />
<br />
I don't know what sort of scaling to expect for this job on 40 cores, but your speedup seems to be substantial, unlike what you observed for tiny QA calculations.<br />
<br />
Maybe you are only having speed problems with small jobs? I have seen mysterious slowdown for single-node execution on my laptop depending on the ARMCI_NETWORK setting. See for example the later posts in this thread: <a target='blank' href="http://nwchemgit.github.io/Special_AWCforum/st/id1303/compile_nwchem-6-3_with_openmpi1....html" class="external free">http://nwchemgit.github.io/Special_AWCforum/st/id1303/compile_nwchem-6-3_with_open...</a>
</td>
		                    </tr>
		                                
		                    <tr>
	<td class="edited_on" align="left" colspan="2">
	</td>
</tr>
		                    
		                </table>
		            </td>
        </tr> 
           
        <tr><td class="thread_sig" align="left" colspan="2"></td></tr>
        	
        </table>
<br /><br />
<table width="100%" cellpadding="0" cellspacing="0" class="bot_breadcrumbs_and_pagejump">
	<tr>
		<td width="100%" class="bot_breadcrumbs"><a href="../index.html">Forum</a> &gt;&gt; <a href="../sc/id2.html">NWChem's corner</a> &gt;&gt; <a href="../sf/id4.html">Compiling NWChem</a></td>
	</tr>
	<tr>
		<td width="100%" class="bot_pagejumps"></td>
	</tr>
</table>
<br /><br />      <br />
</body> 
</html> 
