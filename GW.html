<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="canonical" href="https://nwchemgit.github.io/GW.html">
  <link rel="shortcut icon" href="img/favicon.ico">
  <title>GW - NWChem</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="css/theme.css" />
  <link rel="stylesheet" href="css/theme_extra.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "GW";
    var mkdocs_page_input_path = "GW.md";
    var mkdocs_page_url = "/GW.html";
  </script>
  
  <script src="js/jquery-2.1.1.min.js" defer></script>
  <script src="js/modernizr-2.8.3.min.js" defer></script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="." class="icon icon-home"> NWChem</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="Home.html">NWChem Manual</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="Download.html">How to download and install NWChem</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="Quantum-Mechanical-Methods.html">Quantum Mechanical Methods</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="Quantum-Molecular-Dynamics.html">Quantum Molecular Dynamics</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="Hybrid-Approaches.html">Hybrid Approaches</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="Other-Capabilities.html">Other Capabilities</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="Examples.html">NWChem Examples</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="Compiling-NWChem.html">How to Compile NWChem</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="Benchmarks.html">Benchmarks performed with NWChem</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="Known-Bugs.html">Known Bugs</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="FAQ.html">FAQ</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="Tutorials.html">NWChem Tutorials</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="Forum.html">Forum</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="Archived-Forum.html">Archived Forum</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="EMSL_Arrows.html">EMSL Arrows</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="Software-supporting-NWChem.html">Software supporting NWChem</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="Supplementary-Information.html">Supplementary Information</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="Containers.html">Containers</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href=".">NWChem</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".">Docs</a> &raquo;</li>
    
      
    
    <li>GW</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/nwchemgit/nwchem-wiki/blob/master/GW.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="gw">GW<a class="headerlink" href="#gw" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>Electron attachment and detachment energies can be accurately described
by many-body perturbation theory (MBPT) methods. In particular, the 
<em>GW</em> approximation (GWA) to the self-energy is a MBPT method that has 
seen recent interest in its application to molecules due to a
promising cost/accuracy ratio.</p>
<p>The <em>GW</em> module implemented in NWChem takes a <a href="Density-Functional-Theory-for-Molecules.html">DFT</a>
mean-field approximation to the Green&rsquo;s function, <em>G<sub>0</sub></em>, in order to
solve the quasiparticle equation at the one-shot <em>G<sub>0</sub>W<sub>0</sub></em> or
at various <em>levels</em> of the eigenvalue self-consistent <em>GW</em> approach (ev<em>GW</em>).
Since the mean-field orbitals are kept fixed in all these
approaches, the results depend on the actual starting
point <em>G<sub>0</sub></em> (hence, they depend on the exchange-correlation
functional chosen for the underlying DFT calculation).
For example, it has been known that a large fraction of exact exchange
is needed for the accurate prediction of core-level binding energies at the
one-shot <em>G<sub>0</sub>W<sub>0</sub></em> level.</p>
<p>For further theoretical insights and details about the actual implementation in
NWChem, please refer to the following paper:</p>
<ul>
<li>D. Mejia-Rodriguez, A. Kunitsa, E. Apr&agrave;, N. Govind,
    <a href="https://doi.org/10.1021/acs.jctc.1c00738">Scalable Molecular GW Calculations: Valence and Core Spectra</a>
    <em>J. Chem. Theory Comput.</em> <strong>17</strong>, 7504 (2021).</li>
</ul>
<p><em>GW</em> input is provided using the compound directive</p>
<pre><code>GW
  ...
END
</code></pre>
<p>The actual <em>GW</em> calculation will be performed when the 
input module encounters the <a href="TASK.html">TASK</a> directive.</p>
<pre><code>TASK DFT GW
</code></pre>
<p>Note that <code>DFT</code> must be specified as the underlying <em>QM</em> theory before 
<code>GW</code>. The <a href="Charge.html">charge</a>, <a href="Geometry.html">geometry</a>, and 
<a href="Density-Functional-Theory-for-Molecules.html">DFT</a> options are all specified as
normal. </p>
<p>In addition to an atomic orbital <a href="Basis.html">basis set</a>, the <em>GW</em> module <strong>requires</strong> 
an <em>auxiliary basis set</em> to be provided in order to fit the four-center 
electron repulsion integrals. The auxliary basis set can have either the
 <code>cd basis</code> or <code>ri basis</code> names (see also <a href="Density-Functional-Theory-for-Molecules.html#specification-of-basis-sets-for-the-dft-module">DFT</a>). Three combinations can be obtained:</p>
<ul>
<li>If a <code>ri basis</code> is given without a <code>cd basis</code>,
    the ground-state DFT will be performed without density fitting,
    and the <em>GW</em> task will use the <code>ri basis</code> to fit the integrals.</li>
<li>If a <code>cd basis</code> is given without a <code>ri basis</code>,
    <strong>both</strong> DFT and <em>GW</em> tasks will be performed using the 
    <code>cd basis</code> to fit the integrals.</li>
<li>If both <code>cd basis</code> and <code>ri basis</code> are present, the <code>cd basis</code> will be used
    for the DFT task, while the <code>ri basis</code> will be used
    for the <em>GW</em> task.</li>
</ul>
<h2 id="gw-input-directive">GW Input directive<a class="headerlink" href="#gw-input-directive" title="Permanent link">&para;</a></h2>
<p>There are sub-directives which allow for customized <em>GW</em> calculations.
The most general <em>GW</em> input block directive will look like:</p>
<pre><code>GW
  RPA 
  CORE
  EVGW [&lt;integer eviter default 4&gt;]
  EVGW0 [&lt;integer eviter default 4&gt;]
  FIRST &lt;integer first_orbital default 1&gt;
  METHOD [ [analytic] || [cdgw &lt;integer grid_points default 200&gt;] ]
  ETA &lt;real infinitesimal default 0.001&gt; 
  SOLVER [ [newton &lt;integer maxiter default 10&gt; ] || [graph] ]
  STATES [ [ alpha || beta ] [occ &lt;integer number default 1&gt;] [vir &lt;integer default 0&gt;] ]
  CONVERGENCE &lt;real threshold default 0.005&gt; [&lt;string units default ev&gt;]
END
</code></pre>
<p>The following sections describe these keywords.</p>
<h3 id="rpa">RPA<a class="headerlink" href="#rpa" title="Permanent link">&para;</a></h3>
<p>The keyword <code>RPA</code> triggers the computation of the RPA correlation energy.
This adds a little overhead to the <a href="#method"><em>CD-GW</em></a> approach.</p>
<h3 id="core-and-first">CORE and FIRST<a class="headerlink" href="#core-and-first" title="Permanent link">&para;</a></h3>
<p>The <code>CORE</code> keyword forces to start counting the <a href="#states"><code>STATES</code></a>
from the <code>FIRST</code> molecular orbital <strong>upwards</strong>. </p>
<p>The <code>FIRST</code> keyword has no meaning without <code>CORE</code> specified.</p>
<h3 id="evgw-and-evgw0">EVGW and EVGW0<a class="headerlink" href="#evgw-and-evgw0" title="Permanent link">&para;</a></h3>
<p>The <code>EVGW</code> keyword trigger the partial self-consistnet ev<em>GW</em> approach,
where both the Green&rsquo;s function <em>G</em> and the screened Coulomb <em>W</em> are updated
by using the quasiparticle energies from the previous step in their 
construction. </p>
<p>Similarly, the <code>EVGW0</code> triggers the ev<em>GW<sub>0</sub></em> approach, where
only the Green&rsquo;s function <em>G</em> is updated with the quasiparticle energies
of the previous iterations. <em>W<sub>0</sub></em> is kept fixed.</p>
<p>Both partial self-consistent cycles run for <code>eviter</code> number of cycles.</p>
<p>The use of <code>EVGW</code> or <code>EVGW0</code> will trigger the use of a scissor-shift
operator for all states not updated in the <em>evGW</em> cycle.</p>
<h3 id="method">METHOD<a class="headerlink" href="#method" title="Permanent link">&para;</a></h3>
<p>Two different techniques to obtain the diagonal self-energy
matrix elements are implemented in NWChem. </p>
<p>The <code>analytic</code> method builds and diagonalizes the full Casida RPA matrix
in order to obtain the screened Coulomb matrix elements. The Casida RPA
matrix grows very rapidly in size (<em>N<sub>occ</sub></em> &times; <em>N<sub>vir</sub></em>)
and ultimately yields a <em>N<sup>6</sup></em> scaling due to the diagonalization step.
It is therefore recommended to link the <a href="https://elpa.mpcdf.mpg.de/">ELPA</a>
and turn on its use by setting</p>
<pre><code>SET dft:scaleig e
</code></pre>
<p>The <code>cdgw</code> method uses the Contour-Deformation technique in order to
avoid the <em>N<sup>6</sup></em> diagonalization step. The diagonal self-energy
matrix elements &#x01A9;<sub><em>nn</em></sub> are obtained via a numerical
integration on the imaginary axis and the integrals over closed contours
on the first and third quadrants of the complex plane. The <code>grid_points</code>
value controls  the density of the modified Gauss-Legendre grid used
in the numerical integration over the imaginary axis.</p>
<p>Both <code>analytic</code> and <code>cdgw</code> methods are suitable for <em>core</em> <strong>and</strong>
<em>valence</em> calculations.</p>
<h3 id="eta">ETA<a class="headerlink" href="#eta" title="Permanent link">&para;</a></h3>
<p>The magnitude of the imaginary infinitesimal can be controlled using the
keyword <code>ETA</code>. The default value of <code>0.001</code> should work rather well
for <em>valence</em> calculations, but <code>CORE</code> calculations might need a
larger value, sometimes between <code>0.005</code> or even <code>0.01</code>.</p>
<h3 id="solver">SOLVER<a class="headerlink" href="#solver" title="Permanent link">&para;</a></h3>
<p>Two methods to solver the quasiparticle equations are implemented
in NWChem. </p>
<p>The <code>newton</code> method uses a modified Newton approach to find the fixed-point
of the quasiparticle equations. The Newton method tries to bracket the
solution and switches to a golden section method whenever the Newton step goes
beyond the bracketing values.</p>
<p>The <code>graph</code> method uses a frequency grid in order to bracket the solution
between two consecutive grid points. The number of grid points is controlled 
heuristically depending on the <a href="#method"><code>METHOD</code></a>
and on the presence, or not, of nearby states in a cluster
of energy (see below).</p>
<p>Regardless of the solver, the energies of the states are always
classified in clusters with a maximum extension of <code>1.5 eV</code>. For
a given cluster of energies, the
<code>newton</code> method will start with the state closer to the Fermi level
and use its solution as guess for the rest of the states in the cluster.
The <code>graph</code> method will look for the solution of all the states
in a given cluster at once with a frequency grid with range large 
enough to encompass all the cluster &plusmn; <code>0.2 eV</code>.</p>
<h3 id="states">STATES<a class="headerlink" href="#states" title="Permanent link">&para;</a></h3>
<p>The keyword <code>STATES</code> controls for which particular state
the <em>GW</em> quasiparticle equations are to be solved. The
keyword might appear twice, one for the <em>alpha</em> spin channel
and one for the <em>beta</em> channel. The <em>beta</em> channel keyword is
meaningless for restricted closed-shell DFT calculations 
(<code>MULT 1</code> without <code>ODFT</code> in the <code>DFT</code> input block).</p>
<p>The number of occupied states will be counted starting from the 
state closest to the Fermi level (HOMO) unless the keyword
<a href="#core-and-first"><code>CORE</code></a> is present. The virtual states will <strong>always</strong>
be counted from the state closest to the Fermi level upwards.</p>
<p>A <strong>-1</strong> following either <code>occ</code> or <code>vir</code> stands for all
states in the respective space.</p>
<h3 id="convergence">CONVERGENCE<a class="headerlink" href="#convergence" title="Permanent link">&para;</a></h3>
<p>The converegnce threshold of the quasiparticle equations can
be controlled with the keyword <code>CONVERGENCE</code> and might be
given either in <code>eV</code> or Hartree <code>au</code>.</p>
<h2 id="sample-input-file">Sample Input File<a class="headerlink" href="#sample-input-file" title="Permanent link">&para;</a></h2>
<ul>
<li>A <em>GW</em> calculation requesting the core-level binding 
energies of all 1<em>s</em> states (6 Fluorines and 6 Carbons)
using the <a href="#method">CD-GW</a> method.</li>
</ul>
<pre><code>title &quot;CDGW C6F6 core&quot;
start
echo

memory 2000 mb

geometry
 C     -0.21589696     1.38358991     0.00000000
 C     -1.30618181     0.50480033     0.00000000
 C     -1.09023026    -0.87871037     0.00000000
 C      0.21590562    -1.38360671     0.00000000
 C      1.30610372    -0.50476737     0.00000000
 C      1.09020243     0.87883094     0.00000000
 F     -0.42025331     2.69273557     0.00000000
 F     -2.54211642     0.98238922     0.00000000
 F     -2.12174279    -1.71033945     0.00000000
 F      0.42026196    -2.69275237     0.00000000
 F      2.54203111    -0.98237286     0.00000000
 F      2.12188428     1.71024875     0.00000000
end

basis &quot;ao basis&quot; spherical
 * library cc-pvdz
end

basis &quot;cd basis&quot; spherical
 * library cc-pvdz-ri
end

dft
 xc xpbe96 0.55 hfexch 0.45 cpbe96 1.0
 direct
end

gw
 core
 eta 0.01
 method cdgw
 solver newton 15
 states alpha occ 12
end

task dft gw
</code></pre>
<ul>
<li>A <em>valence</em> <em>GW</em> calculation to obtain the vertical ionization
potential and the vertical electron affinity of the water
molecule using the <a href="#method">analytic</a> method.</li>
</ul>
<pre><code>start

geometry
O     -0.000545       1.517541       0.000000
H      0.094538       0.553640       0.000000
H      0.901237       1.847958       0.000000
end

basis &quot;ao basis&quot; spherical
 h library def2-svp
 o library def2-svp
end

basis &quot;cd basis&quot; spherical
 h library def2-universal-jkfit
 o library def2-universal-jkfit
end

dft
 mult 1
 xc pbe96
 grid fine
 direct
end

gw
 states alpha occ 1 vir 1
end

task dft gw
</code></pre>
<ul>
<li>An ev<em>GW</em><sub>0</sub> calculation with 10 iterations
using the <a href="#method">analytic</a> method.
All occupied energies, but only 10 virtual ones, are
updated using <em>GW</em>. The rest of the virtual states
are shifted using the so-called scissor operator.</li>
</ul>
<pre><code>start

geometry
O     -0.000545       1.517541       0.000000
H      0.094538       0.553640       0.000000
H      0.901237       1.847958       0.000000
end

basis &quot;ao basis&quot; spherical
 h library def2-svp
 o library def2-svp
end

basis &quot;cd basis&quot; spherical
 h library def2-universal-jkfit
 o library def2-universal-jkfit
end

dft
 mult 1
 xc pbe96
 grid fine
 direct
end

gw
 evgw0 10
 states alpha occ -1 vir 10
end

task dft gw
</code></pre>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/nwchemgit/nwchem-wiki/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
    
  </span>
</div>
    <script>var base_url = '.';</script>
    <script src="js/theme_extra.js" defer></script>
    <script src="js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML" defer></script>
      <script src="search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
